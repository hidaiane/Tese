---
title: "An√°lise de Correla√ß√£o entre Vari√°veis de Qualidade da √Ågua"
output: 
  github_document:
    fig_width: 12
    fig_height: 8
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Introdu√ß√£o

Este tutorial ensina a calcular e visualizar coeficientes de correla√ß√£o de Spearman entre par√¢metros de qualidade da √°gua, precipita√ß√£o e vaz√£o, separados por per√≠odos **chuvoso** e **seco**. O passo a passo √© detalhado para permitir a reprodu√ß√£o com **outros conjuntos de dados**.

---

## 1. Preparar o Ambiente

### 1.1 Carregar os pacotes necess√°rios

```{r}
if (!require("pacman")) install.packages("pacman")
library(pacman)
pacman::p_load(tidyverse, readxl, psych)
```

> üîß **Nota**: `pacman` instala automaticamente pacotes faltantes.

### 1.2 Definir o diret√≥rio de trabalho

```{r}
setwd("C:/Users/HP/OneDrive/Documentos/Doutorado/Tese/1) Dados")
```

> üîß **Altere o caminho conforme sua estrutura de pastas.**

---

## 2. Carregar os Dados do Excel

```{r}
dados <- read_excel("Dados_Ipojuca.xlsx", sheet = 1)
```

> üîç **Substitua o nome do arquivo conforme o seu.**

---

## 3. Verificar e Corrigir Tipos de Vari√°veis

Pode acontecer de o R n√£o ler corretamente o tipo de vari√°vel adequado para a an√°lise, como, por exemplo, n√£o reconhecer uma vari√°vel num√©rica.
Por isso, √© importante sempre fazer uma verifica√ß√£o se os tipos de vari√°veis est√£o corretos para an√°lise. A fun√ß√£o **glimpse()** do tidyverse/dplyr permite a visualiza√ß√£o de um resumo dos dados, mostrando o tipo de cada coluna.

```{r}
glimpse(dados)
```

Neste caso, o R reconheceu a coluna **Sal** como tipo **character**. √â necess√°rio corrigir isso.

```{r}
# Transformar a coluna Sal para o tipo num√©rico
dados$Sal <- as.numeric(dados$Sal)
```

> ‚ö†Ô∏è **Corrija vari√°veis num√©ricas lidas como texto.**

---

Verifique o resumo dos dados novamente
```{r}
glimpse(dados)
```

## 4. An√°lises de Correla√ß√£o

Agora que temos os tipos corretos de vari√°veis, podemos gerar os gr√°ficos de correla√ß√£o

### 4.1 Per√≠odo Chuvoso

#### 4.1.1 Filtrar dados e renomear colunas, se necess√°rio

```{r}
dados_chuvoso <- dados %>%
  filter(Estacao != "IP-97",
         Periodo_real == "Chuvoso") %>%
  rename("Precipita√ß√£o" = "Precip_media",
         "Vaz√£o" = "Vazao_media")
```

#### 4.1.2 Gerar gr√°fico

```{r}
pairs.panels(
  dados_chuvoso[,9:22],
  method = "spearman",
  pch = 21,
  bg = c("#0073C2FF", "#EFC000FF")[factor(dados_chuvoso$Periodo_real)],
  hist.col = "lightgray",
  density = TRUE,
  ellipses = FALSE,
  stars = TRUE,
  scale = FALSE,
  cex.cor = 1,
  cex.labels = 1.1
)
```

---

### 4.2 Per√≠odo Seco

O mesmo procedimento anterior, mas agora filtrando os dados para o per√≠odo seco

#### 4.2.1 Filtrar dados  e renomear colunas, se necess√°rio

```{r}
dados_seco <- dados %>%
  filter(Estacao != "IP-97",
         Periodo_real == "Seco") %>%
  rename("Precipita√ß√£o" = "Precip_media",
         "Vaz√£o" = "Vazao_media")
```

#### 4.2.2 Gerar gr√°fico

```{r}
pairs.panels(
  dados_seco[,9:22],
  method = "spearman",
  pch = 21,
  bg = c("#EFC000FF", "#0073C2FF")[factor(dados_seco$Periodo_real)],
  hist.col = "lightgray",
  density = TRUE,
  ellipses = FALSE,
  stars = TRUE,
  scale = FALSE,
  cex.cor = 1,
  cex.labels = 1.1
)
```

---

## 5. Considera√ß√µes Finais

- Verifique aus√™ncias (NA) nas vari√°veis.
- Ajuste o intervalo `[,9:22]` conforme seu banco de dados.
- Correla√ß√£o ‚â† causalidade.


